alias: dbcreator
description: Database Configurator
version: 1.0
changes:
  - 1.0 Initial schema management. Requires 9.10 node

environments:
  default:                                  # defaults
    # product and fix repositories
    repo.product:        ${}
    repo.fix:            ${}
    repo.spm:            ${repo.product}

    dbc.host:            ${}
    dbc.fixes:           ALL
    
    # Database connection
    db.type:             ${}                # REQUIRED: Database type: oracle,sqlserver,db2
    db.host:             ${}                # REQUIRED: Database server hostname
    db.port:             ${}                # REQUIRED: Database server port
    db.name:             ${}                # Database name
    db.username:         ${}                # Database username
    db.password:         ${}                # Database password
    db.url:              ${}

    # Database server admin connection for storage/user creation

    db.admin.username:   ${}                # REQUIRED: for db storage only
    db.admin.password:   ${}                # REQUIRED: for db storage only
    db.tablespace.dir:   ${}                # REQUIRED: for Oracle/DB2
    db.tablespace.data:  ${}                # for Oracle/DB2
    db.tablespace.index: ${}                # for Oracle/DB2
    
    # Schemas
    db.components:        ${}
    db.products:          ${}
    db.component.version: ${}
    db.product.version:   ${}

    # Remote system configuration
    spm.port:       8092                    # SPM connection port
    spm.secure:     false                   # Use HTTPS connection to SPM: true,false
    spm.configure:  [spm-tuneup]
    spm.fixes:      [wMFix.SPM]             # SPM/SUM/SD core fixes by default

    ## remote provisioning
    #spm.host:         ${dbc.host}                # REQUIRED for all in one installation as default host
    os.username:      ${}                       # remote machine SSH username, default CCE process user account (as java system property)
    os.password:      ${}                       # remote machine SSH password
    os.auth.method:   ${}                       # remote machine authentication method: PASSWORD,INTERACTIVE,CERTIFICATE
    os.auth.key:      ${}                       # keyfile for CERTIFICATE auth method
    os.ssh.port:      ${}                        # remote machine SSH port
    install.dir:      ${}                       # suite installation directory
    install.installer: ${}
    #spm.distribution: ALL                       # EXPERIMENTAL! distribution, ALL, DEF, MIN
    #spm.useImage:     false                     # EXPERIMENTAL! false for direct connection to the MASTER repo!

  server:

  docker:
    dbc.host:           localhost
    spm.alias:          local

layers:
  default:
    productRepo: ${repo.product}            # install products from
    fixRepo:     ${repo.fix}                # install fixes from

  spm:
    description: Management layer of SPM's
    templates:   ${spm.configure}

  dbc:
    templates:
      - dbc
    databases:
      dbc-components:
        components:  ${db.components}
        version:     ${db.component.version}
        db.type:     ${db.type}
        db.url:      ${db.url}
        db.username: ${db.username}
        db.password: ${db.password}
        db.name:     ${db.name}
        db.admin.username: ${db.admin.username}
        db.admin.password: ${db.admin.password}
        db.tablespace.dir: ${db.tablespace.dir}
        db.tablespace.data: ${db.tablespace.data}
        db.tablespace.index: ${db.tablespace.index}

      dbc-products:
        products:    ${db.products}
        version:     ${db.product.version}
        db.type:     ${db.type}
        db.url:      ${db.url}
        db.username: ${db.username}
        db.password: ${db.password}
        db.name:     ${db.name}
    
templates:
  spm-tuneup:
    description: SPM customizations
    fixes: ${spm.fixes}
    products:
      SPM:

  dbc:
    description: DB Schema Management using DatabaseComponentConfigurator
    products:
      DatabaseComponentConfigurator:
    fixes: ${dbc.fixes}


provision:
  default:
    spm:  ["${dbc.host}"]
    dbc:  ["${dbc.host}"]
  server:
    spm:  ["${dbc.host}"]
    dbc:  ["${dbc.host}"]
  docker:
    spm:  ["${spm.alias}"]
    dbc:  ["${spm.alias}"]

nodes:
  default:
    default:
      port:   ${spm.port}
      secure: ${spm.secure}
      bootstrapInfo:
        installDir:   ${install.dir}
        installer:    ${install.installer}
        port:         ${os.ssh.port}
        credentials:
          userName:   ${os.username}
          password:   ${os.password}
          authenticationMethod: ${os.auth.method}
          privateKey: ${os.auth.key}
  docker:
    ${spm.alias}:
      host: ${dbc.host}