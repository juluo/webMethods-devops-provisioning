alias: sag-internaldatastore-cluster
description: Internal Data Store provisioning in cluster configuration

environments:
  default:
    nodes:                 ${}
    release.major:         10                                                   # release major version number
    ids.port:              9340
    ids.fixes:             ${}
    ids.repo.shared.path:  "/opt/softwareag/InternalDataStore/archives"
    
layers:
  runtime:
    productRepo:           ${repo.product}
    fixRepo:               ${repo.fix}
    templates:             ids-cluster-${runtime.nodes.count}
    
templates:
  ids-cluster-1:
    fixes: ${ids.fixes}
    products:
      CEL:
  
  ids-cluster-2:
    fixes: ${ids.fixes}
    products:
      CEL:
        CEL:
          configuration:
            CEL:
              COMMON-CLUSTER:
                COMMON-CLUSTER-default:
                  Enabled: 'true'
                  Name: SAG_EventDataStore
                  Servers:
                    Server:
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[1]}
                        - '@name': port
                          $: ${ids.port}
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[2]}
                        - '@name': port
                          $: ${ids.port} 
              CUSTOM-PROPERTIES:
                CUSTOM-PROPERTIES-default: |
                  path.repo: ${ids.repo.shared.path}
                  discovery.zen.minimum_master_nodes: ${runtime.nodes.count}
                  node.master: true
                  node.data: true
  
  ids-cluster-3:
    fixes: ${ids.fixes}
    products:
      CEL:
        CEL:
          configuration:
            CEL:
              COMMON-CLUSTER:
                COMMON-CLUSTER-default:
                  Enabled: 'true'
                  Name: SAG_EventDataStore
                  Servers:
                    Server:
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[1]}
                        - '@name': port
                          $: ${ids.port}
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[2]}
                        - '@name': port
                          $: ${ids.port}     
                    - ExtendedProperties:
                        Property:
                        - '@name': host
                          $: ${runtime.hosts[3]}
                        - '@name': port
                          $: ${ids.port}                                              
              CUSTOM-PROPERTIES:
                CUSTOM-PROPERTIES-default: |
                  path.repo: ${ids.repo.shared.path}
                  discovery.zen.minimum_master_nodes: ${runtime.nodes.count}
                  node.master: true
                  node.data: true
    products:
      CEL:
        default:
          configuration:
            CEL:
              COMMON-CLUSTER:
                COMMON-CLUSTER-default:
                  Enabled: 'true'
                  Name: SAG_EventDataStore
                  Servers:
                    Server:
                      ExtendedProperties:
                        Property:
                        - '@name': node
                          $: ip-20-35-5-190.ec2.internal1572323498613
                        - '@name': host
                          $: localhost
                        - '@name': port
                          $: '9340'

                          
provision:
  default:
    runtime: ${nodes}

nodes:
  default:
    default:
      port:   ${spm.port}
      secure: ${spm.secure}
      credentials: ${spm.credentials.alias}
      bootstrapInfo:
        installDir:   ${bootstrap.install.dir}
        installer:    ${bootstrap.install.installer}
        port:         ${bootstrap.ssh.port}
        credentials:  ${bootstrap.credentials.alias}