alias: container
description: Terracotta Server or array layer

environments:
  default:                                  # defaults
    repo.product: products
    repo.fix:     fixes

    tc.host:     localhost                        # REQURIED tc installation host
    tc.tsa.port: 9010
    tc.jmx.port: 9020
    tc.grp.port: 9030
    tc.mgt.port: 9040
    tc.memory.init:   2024
    tc.memory.max:    2024
    tc.storage.size:  50g
    tc.offheap.size:  2g
    tc.fixes:         ALL                   # List of fixes to install
    tc.configure:     [tc-server]

  server:

  cluster:
    tc.host:  tc1
    tc.host2: tc2                          # REQURIED tc installation host2
    tc.configure: [tc-server,tc-cluster]

layers:
  default:
    productRepo: ${repo.product}
    fixRepo:     ${repo.fix}
  runtime:
    description: Cache Layer based on Terracotta Server
    templates:   ${tc.configure}

templates:
  tc-server:
#    licenses:
#      "Terracotta/terracotta-license.key": ${tc.license.key.alias}
    fixes: ${tc.fixes}
    products:
      TES:
        default:
          configuration:
            TES-default:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: ${tc.memory.init}
                  MaxSize:  ${tc.memory.max}
              TC-CONFIG:
                TC-CONFIG: |
                  <ns2:tc-config xmlns:ns2="http://www.terracotta.org/config">
                    <servers>
                      <server name="${node.host}" host="${node.host}" >
                        <data>../data</data>
                        <logs>../logs</logs>
                        <index>../index</index>
                        <tsa-port>${tc.tsa.port}</tsa-port>
                        <jmx-port>${tc.jmx.port}</jmx-port>
                        <tsa-group-port>${tc.grp.port}</tsa-group-port>
                        <management-port>${tc.mgt.port}</management-port>
                        <dataStorage size="${tc.storage.size}">
                           <offheap size="${tc.offheap.size}"/>
                           <hybrid/>
                        </dataStorage>
                      </server>
                    </servers>
                  </ns2:tc-config>
              TC-SERVER-NAME:
                TC-SERVER-NAME:
                  serverName: ${node.host}

  tc-cluster:
    products:
      TES:
        default:
          configuration:
            TES-default:
              TC-CONFIG:
                TC-CONFIG: |
                  <ns2:tc-config xmlns:ns2="http://www.terracotta.org/config">
                    <servers>
                      <mirror-group group-name="stripe1">
                          <server name="${tc.host}" host="${tc.host}" >
                            <data>../data</data>
                            <logs>../logs</logs>
                            <index>../index</index>
                            <tsa-port>${tc.tsa.port}</tsa-port>
                            <jmx-port>${tc.jmx.port}</jmx-port>
                            <tsa-group-port>${tc.grp.port}</tsa-group-port>
                            <management-port>${tc.mgt.port}</management-port>
                            <dataStorage size="${tc.storage.size}">
                               <offheap size="${tc.offheap.size}"/>
                               <hybrid/>
                            </dataStorage>
                          </server>
                          <server name="${tc.host2}" host="${tc.host2}" >
                            <data>../data</data>
                            <logs>../logs</logs>
                            <index>../index</index>
                            <tsa-port>${tc.tsa.port}</tsa-port>
                            <jmx-port>${tc.jmx.port}</jmx-port>
                            <tsa-group-port>${tc.grp.port}</tsa-group-port>
                            <management-port>${tc.mgt.port}</management-port>
                            <dataStorage size="${tc.storage.size}">
                               <offheap size="${tc.offheap.size}"/>
                               <hybrid/>
                            </dataStorage>
                          </server>
                      </mirror-group>
                    </servers>
                  </ns2:tc-config>

provision:
  default:
    runtime: local