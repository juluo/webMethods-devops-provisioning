alias: bpms-layer
description: BPMS environment with UM,TC,BPM,MWS layers/clusters

environments:
  default:                                  # defaults
    repo.product:        products
    repo.fix:            fixes

    spm.port:       8092                    # SPM connection port
    spm.secure:     false                   # Use HTTPS connection to SPM: true,false
    spm.memory.max: 512                     # max mem
    spm.configure:  [spm-tuneup]    
    spm.fixes:      [wMFix.SPM]             # SPM/SUM/SD core fixes by default

    # Universal Messaging Server.
    um.host:              um

    # Terracotta Server.
    tc.host:              tc

    # BPMS / Integration Server. See is-layer template for parameters documentation
    bpms.host:           bpms
    is.instance.name:    default            # IS BPM instance
    is.primary.port:     5555
    is.diagnostic.port:  9999
    is.jmx.port:         8094
    is.install.service:  true
    is.memory.init:      256                # memory configuration
    is.memory.max:       1024               # memory configuration
    is.lb.protocol:      HTTP               # external load balancer protocol
    is.lb.host:          ${bpm.host}        # external load balancer host
    is.lb.port:          ${is.primary.port} # external load balancer port
    is.fixes:            ALL
    is.configure:        [bpm-server]
    is.cluster.enabled:  true
    is.tsa.url:          ${tc.host}:${tc.tsa.port}

    env.password:        manage             # IS/MWS Administrator password

    # licenses
    os.platform:             lnxamd64
    is.license.key.alias:    "Integration_Server-${os.platform}"
    tc.license.key.alias:    "terracotta-license-${os.platform}"
    rules.license.key.alias: "Business_Rules_Advanced-${os.platform}"

    # Database connection
    db.type:             oracle             # REQUIRED: Database type: oracle,sqlserver,db2
    db.host:             bpms_db             # REQUIRED: Database server hostname
    db.port:             1521               # REQUIRED: Database server port
    db.name:             webm
    db.username:         bpms_dbuser         # Database username
    db.password:         strong123!         # Database password
    db.sid:              XE                 # Database name
    db.url.oracle:       "jdbc:wm:oracle://${db.host}:${db.port};SID=${db.sid}"
    db.url.sqlserver:    "jdbc:wm:${db.type}://${db.host}:${db.port};databaseName=${db.name}"
    db.url:              ${db.url.oracle}

layers:
  default:
    productRepo: ${repo.product}
    fixRepo:     ${repo.fix}

  spm:
    description: Management layer of SPM's
    templates:   ${spm.configure}

  bpm:
    description: Business Process Management layer based on Integration Server
    templates:   ${bpm.configure}

templates:
  spm-tuneup:
    description: SPM customizations
    fixes:       ${spm.fixes}
    products:
      # SUM:       # Ensure we have SUM installed - no longer needed for 10.1
      SPM:
      ISspm:
      PIFspm:
      WMNspm:
      WOKspm:
      EDAspm:
      WOKMWSspm:
      MwsSpmIsTask:
      MwsSpmTaskEngine:

  bpm-server: # Custom IS BPM setup
    description: BPM layer can be single server or a cluster
    licenses:
      "IntegrationServer/config/licenseKey.xml": ${is.license.key.alias} 
      "IntegrationServer/instances/${is.instance.name}/packages/WmBusinessRules/config/licenseKey.xml": ${rules.license.key.alias} 
      "common/conf/terracotta-license.key": ${tc.license.key.alias} 
    fixes: ${is.fixes}
    products:
      brmspackage:
      Monitor:
      TaskClientPackage:
      Deployer:
      NUMDeployer:
      wmprt:
      integrationServer: # the core IS product that owns the instance
        ${is.instance.name}:
          primary.port:    ${is.primary.port}
          diagnostic.port: ${is.diagnostic.port}
          jmx.port:        ${is.jmx.port}
          license.file:    IntegrationServer/config/licenseKey.xml
          install.service: ${is.install.service}
          package.list:    WmMonitor,WmTaskClient,WmBusinessRules,WmDeployer,WmNUMDeployer,WmPRT
          db.type:         ${db.type}
          db.url:          "${db.url}"
          db.username:     ${db.username}
          db.password:     ${db.password}
          db.alias:        Default
          configuration:
            OSGI-IS_${instance.name}:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: ${is.memory.init}
                  MaxSize: ${is.memory.max}
            integrationServer-${instance.name}:
              COMMON-JNDI:
                COMMON-JNDI-DEFAULT_IS_JNDI_PROVIDER:
                  JNDI: 
                    "@alias": DEFAULT_IS_JNDI_PROVIDER
                    Description: Default JNDI provider alias
                    Provider: 
                      URL: "${um.cluster.url}"
                      InitialContextFactory: com.pcbsys.nirvana.nSpace.NirvanaContextFactory
              COMMON-WMMESSAGING:
                COMMON-WMMESSAGING-IS_UM_CONNECTION:
                  Messaging: 
                    "@alias": IS_UM_CONNECTION
                    Description: Default UM connection alias
                    ClientPrefix: IS_UM
                    ShareClientPrefix: false
                    Enabled: true
                    Provider: 
                      "@type": UM
                      URL: "${um.cluster.url}"
                      MaxRetryAttempts: 5
                      RetryInterval: 30000
              COMMON-JMS:
                COMMON-JMS-DEFAULT_IS_JMS_CONNECTION:
                  JMS: 
                    "@alias": DEFAULT_IS_JMS_CONNECTION
                    Description: Default JMS connection alias
                    Enabled: true
                    TransactionType: NO_TRANSACTION
                    ClientId: DEFAULT_IS_JMS_CLIENT
                    Provider: 
                      "@type": JNDI
                      JNDIAlias: DEFAULT_IS_JNDI_PROVIDER
                      JNDIConnectionFactoryName: ${um.jndi.cf}
                    User: ""
                    MaxRetryAttempts: 0
                    RetryInterval: 0
                    Caching: DISABLED
                    ExtendedProperties: 
                      Property: 
                        - 
                          "@name": "jndi_connectionFactoryUpdateType"
                          $: "NONE"
                        - 
                          "@name": "jndi_connectionFactoryPollingInterval"
                          $: "0"
                        - 
                          "@name": "classLoader"
                          $: "INTEGRATION_SERVER"
                        - 
                          "@name": "csqSize"
                          $: "-1"
                        - 
                          "@name": "csqDrainInOrder"
                          $: "true"
                        - 
                          "@name": "optTempQueueCreate"
                          $: "true"
                        - 
                          "@name": "manageDestinations"
                          $: "true"
                        - 
                          "@name": "allowNewConnectionPerTrigger"
                          $: "false"
                COMMON-JMS-PE_NONTRANSACTIONAL_ALIAS:
                  JMS: 
                    "@alias": PE_NONTRANSACTIONAL_ALIAS
                    Description: Default PE JMS connection alias
                    Enabled: true
                    TransactionType: NO_TRANSACTION
                    ClientId: IS_PE
                    Provider: 
                      "@type": JNDI
                      JNDIAlias: DEFAULT_IS_JNDI_PROVIDER
                      JNDIConnectionFactoryName: ${um.jndi.cf}
                    User: ""
                    MaxRetryAttempts: 0
                    RetryInterval: 0
                    Caching: DISABLED
                    ExtendedProperties: 
                      Property: 
                        - 
                          "@name": "jndi_connectionFactoryUpdateType"
                          $: "NONE"
                        - 
                          "@name": "jndi_connectionFactoryPollingInterval"
                          $: "0"
                        - 
                          "@name": "classLoader"
                          $: "INTEGRATION_SERVER"
                        - 
                          "@name": "csqSize"
                          $: "-1"
                        - 
                          "@name": "csqDrainInOrder"
                          $: "true"
                        - 
                          "@name": "optTempQueueCreate"
                          $: "true"
                        - 
                          "@name": "manageDestinations"
                          $: "true"
                        - 
                          "@name": "allowNewConnectionPerTrigger"
                          $: "false"
              COMMON-DBFUNCTION:
                COMMON-DBFUNCTION-CentralUsers:
                  Function:
                    "@alias": CentralUsers
                    PoolAlias: Default
                    Description: "Central User Management Configuration"
              COMMON-CLUSTER:
                COMMON-CLUSTER:
                  Name: ${instance.name}-cluster
                  Enabled: ${is.cluster.enabled}
                  Servers:
                    Server: 
                      - 
                        URL: ${is.tsa.url} 

            OSGI-IS_${instance.name}-WmMonitor: &MwsEndpoint
              COMMON-COMPONENT-ENDPOINTS:
                COMMON-COMPONENT-ENDPOINTS-MWS:
                  "@alias": MWS
                  Transport:
                    Protocol: ${mws.lb.protocol}
                    Host:     ${mws.lb.host}
                    Port:     ${mws.lb.http.port}
                  Auth:
                    "@type": BASIC
                    User: Administrator
                    Password: ${env.password}
            OSGI-IS_${instance.name}-WmTaskClient: *MwsEndpoint

provision:
  default:
    spm:  ["${bpms.host}"]
    bpm:  ["${bpms.host}"]

nodes:
  default:
    default:
      port:   ${spm.port}
      secure: ${spm.secure}
 
 
