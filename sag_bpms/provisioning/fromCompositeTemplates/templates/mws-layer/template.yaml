alias: mws-layer
description: My webMethods Server single instance or a cluster

environments:
  default:
    repo.product:        products
    repo.fix:            fixes

    spm.port:       8092                    # SPM connection port
    spm.secure:     false                   # Use HTTPS connection to SPM: true,false
    spm.memory.max: 512                     # max mem
    spm.configure:  [spm-tuneup]
    spm.fixes:      [wMFix.SPM]             # SPM/SUM/SD core fixes by default

    # My webMethods Server
    mws.host:            mws                # REQUIRED:
    mws.instance.name:   default
    mws.http.port:       8585
    mws.https.port:      8586
    mws.jmx.port:        8587
    mws.memory.init:     512                # memory configuration
    mws.memory.max:      1024               # memory configuration
    mws.password:        manage
    mws.email:           admin@company.com
    mws.fixes:           ALL
    mws.lb.protocol:     http
    mws.lb.host:         ${mws.host}
    mws.lb.http.port:    ${mws.http.port}
    mws.lb.https.port:   ${mws.https.port}
    mws.configure:       [mws-server]

    env.password:        manage             # IS/MWS Administrator password

    # Database connection
    db.type:             oracle             # REQUIRED: Database type: oracle,sqlserver,db2
    db.host:             mws_db             # REQUIRED: Database server hostname
    db.port:             1521               # REQUIRED: Database server port
    db.name:             webm
    db.username:         mws_dbuser         # Database username
    db.password:         strong123!         # Database password
    db.sid:              XE                 # Database name
    db.url.oracle:       "jdbc:wm:oracle://${db.host}:${db.port};SID=${db.sid}"
    db.url.sqlserver:    "jdbc:wm:${db.type}://${db.host}:${db.port};databaseName=${db.name}"
    db.url:              ${db.url.oracle}

layers:
  default:
    productRepo: ${repo.product}
    fixRepo:     ${repo.fix}

  spm:
    description: Management layer of SPM's
    templates:   ${spm.configure}

  mws:
    description: General purpose MWS layer
    templates:   ${mws.configure}

templates:

# Platform Manager
  spm-tuneup:
    description: SPM customizations
    fixes: ${spm.fixes}
    products:
      # SUM:       # Ensure we have SUM installed - no longer needed for 10.1
      SPM:
      MWSspm:
      ISspm:
      PIFspm:
      WMNspm:
      WOKspm:
      EDAspm:
      WOKMWSspm:
      MwsSpmIsTask:
      MwsSpmTaskEngine:

  mws-server:
    description: MWS instance
    fixes: ${mws.fixes}
    products:
      TaskEngineRuntime:
      brmsui:
      optimizeSharedUI:
      monitorUI:
      MwsProgramFiles: # MWS core product
        ${mws.instance.name}: # MWS instance
          node.name:   ${node.host} # unique cluster node name
          http.port:   ${mws.http.port}
          https.port:  ${mws.https.port}
          jmx.port:    ${mws.jmx.port}
          db.type:     ${db.type}
          db.url:      "${db.url}"
          db.username: ${db.username}
          db.password: ${db.password}
          configuration:
            OSGI-MWS_${instance.name}:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: ${mws.memory.init}
                  MaxSize:  ${mws.memory.max}
            MwsProgramFiles-${instance.name}:
              COMMON-CLUSTER:
                COMMON-CLUSTER:
                  ExtendedProperties:
                    Property:
                      -
                        "@name": LoadBalancerHost
                        $: ${mws.lb.host}
                      -
                        "@name": LoadBalancerHttpPort
                        $: ${mws.lb.http.port}
                      -
                        "@name": LoadBalancerHttpsPort
                        $: ${mws.lb.https.port}
                      -
                        "@name": jndiEnabled
                        $: true
                      -
                        "@name": jndiProviderUrl
                        $: ${um.cluster.url}
              COMMON-SYSPROPS:
                COMMON-SYSPROPS: |
                  update.completed.task=true
                  task.based.permission=false
            MwsProgramFiles-${instance.name}:
              COMMON-LOCAL-USERS:
                COMMON-LOCAL-USERS-Administrator:
                  "@id": Administrator
                  Enabled: true
                  FirstName: My webMethods Administrator
                  LastName:  Administrator
                  Email:     ${mws.email}
                  Password:  ${mws.password}
                COMMON-LOCAL-USERS-SysAdmin:
                  "@id": SysAdmin
                  Enabled: true
                  FirstName: Sys Admin
                  LastName:  Administrator
                  Email:     ${mws.email}
                  Password:  ${mws.password}
              COMMON-CLUSTER:
                COMMON-CLUSTER:
                  ExtendedProperties:
                    Property:
                      -
                        "@name": LoadBalancerHost
                        $: ${mws.lb.host}
                      -
                        "@name": LoadBalancerHttpPort
                        $: ${mws.lb.http.port}
                      -
                        "@name": LoadBalancerHttpsPort
                        $: ${mws.lb.https.port}
                      -
                        "@name": jndiEnabled
                        $: false
            MwsProgramFiles-${instance.name}:
              COMMON-VARS:
                COMMON-VARS-wsclient-password:
                  Variable:
                    "@key": "wsclient-password"
                    "@secure": "true"
                    "@type": "java.lang.String"
                    $: ${env.password}
                COMMON-VARS-wsclient-username:
                  Variable:
                    "@key": "wsclient-username"
                    "@secure": "false"
                    "@type": "java.lang.String"
                    $: Administrator
            TaskEngineRuntime-${instance.name}:
              COMMON-COMPONENT-ENDPOINTS:
                COMMON-COMPONENT-ENDPOINTS-TASKENGINE:
                  "@alias": TASKENGINE
                  Transport:
                    Protocol: ${is.lb.protocol}
                    Host:     ${is.lb.host}
                    Port:     ${is.lb.port}
                  Auth:
                    "@type": BASIC
                    User: Administrator
                    Password: ${env.password}
            brmsui-${instance.name}:
              COMMON-COMPONENT-ENDPOINTS:
                COMMON-COMPONENT-ENDPOINTS-Default:
                  "@alias": Default
                  Description: Default
                  Transport:
                    Protocol: ${is.lb.protocol}
                    Host:     ${is.lb.host}
                    Port:     ${is.lb.port}
                  Auth:
                    "@type": BASIC
                    User: Administrator
                    Password: ${env.password}
            optimizeSharedUI-${instance.name}:
              COMMON-COMPONENT-ENDPOINTS:
                COMMON-COMPONENT-ENDPOINTS-IS-BPMonly:
                  "@alias": IS-BPMonly
                  Description: "BPM only"
                  Transport:
                    Protocol: ${is.lb.protocol}
                    Host:     ${is.lb.host}
                    Port:     ${is.lb.port}
                  Auth:
                    "@type": AUTO

# Provisioning
provision:
  default:
    spm: ["${mws.host}"]
    mws: ["${mws.host}"]

nodes:
  default:
    default:
      port:   ${spm.port}
      secure: ${spm.secure}